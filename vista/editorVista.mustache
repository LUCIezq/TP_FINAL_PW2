<head>
    <link rel="stylesheet" href="/public/assets/editor.css">
</head>

<div class="container">

    <div class="dashboard-slider mb-4">

        {{#opcionesMenu}}
        <a href="#{{ancla}}" class="dashboard-item text-decoration-none">
            <div class="card card-option p-3 h-100">
                <h6 class="fw-bold mb-1">{{titulo}}</h6>
                <p class="text-muted small">{{descripcion}}</p>
            </div>
        </a>
        {{/opcionesMenu}}

    </div>

    {{#message}}
    <div class="alert alert-info alert-dismissible fade show" role="alert">
        {{message}}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {{/message}}

    <section id="crearPregunta" class="mb-5 pt-4">
        <h4 class="fw-bold mb-3">Crear nueva pregunta</h4>

        <div class="card p-4 shadow-sm">
            <form action="/preguntas/createQuestion" method="post">
                <div class="mb-3">
                    <label class="form-label">Enunciado de la pregunta</label>
                    <input type="text" class="form-control" placeholder="Escribe la pregunta..." id="pregunta"
                        name="pregunta" required>
                </div>

                <div class="mb-3">
                    <select class="form-select" required name="categoria">
                        <option disabled selected>Seleccione una categoría</option>
                        {{#categories}}
                        <option value="{{id}}">{{nombre}}</option>
                        {{/categories}}
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Respuestas</label>
                    <div class="d-flex flex-column gap-2">

                        <div class="input-group">
                            <div class="input-group-text">
                                <input type="radio" name="correcta" required>
                            </div>
                            <input type="text" name="respuestas[]" class="form-control" required placeholder="Opción 1">
                        </div>

                        <div class="input-group">
                            <div class="input-group-text">
                                <input type="radio" name="correcta" required>
                            </div>
                            <input type="text" name="respuestas[]" class="form-control" required placeholder="Opción 2">
                        </div>

                        <div class="input-group">
                            <div class="input-group-text">
                                <input type="radio" name="correcta" required>
                            </div>
                            <input type="text" name="respuestas[]" class="form-control" required placeholder="Opción 3">
                        </div>

                        <div class="input-group">
                            <div class="input-group-text">
                                <input type="radio" name="correcta" required>
                            </div>
                            <input type="text" name="respuestas[]" class="form-control" required placeholder="Opción 4">
                        </div>

                    </div>
                </div>

                <button class="btn btn-primary">Guardar pregunta</button>
            </form>
        </div>
    </section>

    <form action="/editor/eliminarPreguntas" method="POST" class="w-100">

        <div class="d-flex justify-content-between w-100">
            <h4 class="fw-bold mb-3">Preguntas del sistema</h4>

            <div class="d-flex justify-content-end mb-5">
                <button type="submit" class="btn btn-danger">
                    Eliminar seleccionadas
                </button>
            </div>
        </div>


        <section id="preguntasSistema" class="d-flex flex-column gap-3"">

        <div class=" card p-4 shadow-sm" style=" height: 800px; overflow-y: scroll;">

            {{#preguntasDelSistema}}

            <div class="d-flex  align-items-center w-100 gap-3">
                <div class="d-flex align-items-center gap-4 w-100">
                    <input type="checkbox" class="form-check-input ms-3" name="ids[]" value="{{pregunta_id}}">

                    <div class=" card shadow-sm mb-4 rounded-3 border-0 w-100" role="button" data-bs-toggle="collapse"
                        data-bs-target="#{{pregunta_id}}">

                        <div class="card-body w-100">

                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <small class="text-muted d-block">
                                        Creada por <strong>{{usuario}}</strong>
                                    </small>
                                    <h6 class="mt-1 fw-bold mb-0">{{enunciado}}</h6>
                                </div>

                                <div class="d-flex align-items-end gap-1">
                                    <span class="badge text-bg-secondary">{{genero_nombre}}</span>
                                    {{#activa}}
                                    <span class="badge text-bg-success">Activa</span>
                                    {{/activa}}
                                    {{^activa}}
                                    <span class="badge text-bg-danger">Inactiva</span>
                                    {{/activa}}
                                </div>

                            </div>

                        </div>

                        <div id="{{pregunta_id}}" class="collapse">

                            <div class="list-group list-group-flush">
                                {{#respuestas}}
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    {{respuesta}}
                                    {{#es_correcta}}
                                    <span class="badge bg-success ms-2">Correcta</span>
                                    {{/es_correcta}}
                                </div>
                                {{/respuestas}}
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            {{/preguntasDelSistema}}

            {{^preguntasDelSistema}}
            <p class="text-muted">No se encontraron preguntas del sistema.</p>
            {{/preguntasDelSistema}}

</div>

</section>
</form>

<form action="/editor/procesarSugerida" method="POST" class="w-100 mt-5">

    <div class="d-flex justify-content-between w-100">
        <h4 class="fw-bold mb-3">Preguntas del sistema</h4>

        <div class="d-flex justify-content-end mb-3 gap-2">
            <button type="submit" name="type" value="aprobar" class="btn btn-primary">
                Aprobar
            </button>
            <button type="submit" name="type" value="rechazar" class="btn btn-danger">
                Rechazar
            </button>
        </div>
    </div>
    <section id="preguntasSugeridas" class="mb-5 pt-4">

        <div class=" card p-4 shadow-sm" style=" height: fit-content; overflow-y: scroll;">

            {{#preguntasSugeridas}}

            <div class="d-flex  align-items-center w-100 gap-3">
                <div class="d-flex align-items-center gap-4 w-100">
                    <input type="checkbox" name="ids[]" value="{{pregunta_id}}" class="form-check-input ">

                    <div class=" card shadow-sm mb-4 rounded-3 border-0 w-100" role="button" data-bs-toggle="collapse"
                        data-bs-target="#{{pregunta_id}}">


                        <div class="card-body w-100">

                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <small class="text-muted d-block">
                                        Sugerida por <strong>{{usuario}}</strong>
                                    </small>
                                    <h6 class="mt-1 fw-bold mb-0">{{enunciado}}</h6>
                                </div>

                                <div class="d-flex align-items-end gap-1">
                                    <span class="badge text-bg-secondary">{{genero_nombre}}</span>
                                    {{#activa}}
                                    <span class="badge text-bg-success">Activa</span>
                                    {{/activa}}
                                    {{^activa}}
                                    <span class="badge text-bg-danger">Inactiva</span>
                                    {{/activa}}
                                </div>

                            </div>

                        </div>

                        <div id="{{pregunta_id}}" class="collapse">

                            <div class="list-group list-group-flush">
                                {{#respuestas}}
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    {{respuesta}}
                                    {{#es_correcta}}
                                    <span class="badge bg-success ms-2">Correcta</span>
                                    {{/es_correcta}}
                                </div>
                                {{/respuestas}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {{/preguntasSugeridas}}

            {{^preguntasSugeridas}}
            <p class="text-muted">No se encontraron preguntas sugeridas.</p>
            {{/preguntasSugeridas}}
        </div>
    </section>

</form>


<section id="preguntasReportadas" class="mb-5 pt-4">
    <h4 class="fw-bold mb-3">Preguntas reportadas</h4>

    <div class="card p-4 shadow-sm">
        <p class="text-muted">Aquí aparecerán las preguntas que tienen reportes pendientes.</p>
    </div>
</section>

<section id="categorias" class="mb-5 pt-4">
    <h4 class="fw-bold mb-3">Categorías</h4>

    <div class="card p-4 shadow-sm">

        <div class="mb-3">
            <label class="form-label">Crear nueva categoría</label>
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Nombre de categoría">
                <button class="btn btn-primary">Crear</button>
            </div>
        </div>

        <hr>

        <p class="text-muted">Listado de categorías existentes:</p>

        <ul class="list-group">
            <li class="list-group-item d-flex justify-content-between">
                <span>Categoría ejemplo</span>
                <button class="btn btn-sm btn-outline-danger">Eliminar</button>
            </li>
        </ul>

    </div>
</section>

</div>

<script>

    document.querySelectorAll('.opcion input[type="radio"]').forEach(radio => {
        radio.addEventListener('change', () => {
            const input = document.getElementById(radio.value);
            if (input) input.focus();
        });
    });

    const formCat = document.getElementById('form');
    document.querySelectorAll('#form button[data-id]').forEach(btn => {
        btn.addEventListener('click', e => {
            e.preventDefault();
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'eliminar_categoria_id';
            input.value = btn.dataset.id;
            formCat.appendChild(input);
            formCat.submit();
        });
    });

</script>