{{> header }}
<link rel="stylesheet" href="/public/assets/dashboardAdmin.css">

<div class="admin-container">

    <!-- SIDEBAR -->
    <aside class="admin-sidebar">
        <h2 class="sidebar-title">ADMIN</h2>
        <ul class="sidebar-menu">
            <li><a href="/admin/index" class="active">üìä Dashboard</a></li>
            <li><a href="/editor/index">üìù Gesti√≥n de Preguntas</a></li>
            <li><a href="/home/index">üè† Volver al Lobby</a></li>
            <li><a href="/login/logout">üö™ Cerrar sesi√≥n</a></li>
        </ul>
    </aside>

    <!-- MAIN -->
    <main class="admin-main">

        <h1 class="dashboard-title">Panel Administrativo</h1>

        <!-- FILTROS -->
        <section class="filter-section mb-4">
            <label class="fw-bold">Filtrar reportes por:</label>
            <select id="filtroPeriodo" class="form-select w-auto d-inline-block ms-2">
                <option value="dia">Hoy</option>
                <option value="semana">√öltima semana</option>
                <option value="mes">√öltimo mes</option>
                <option value="anio">√öltimo a√±o</option>
            </select>
        </section>

        <!-- KPIs -->
        <section class="kpi-grid mb-5">

            <div class="kpi-card shadow-sm">
                <h4>Usuarios Registrados</h4>
                <p>{{totalUsuarios}}</p>
            </div>

            <div class="kpi-card shadow-sm">
                <h4>Partidas Jugadas</h4>
                <p>{{totalPartidas}}</p>
            </div>

            <div class="kpi-card shadow-sm">
                <h4>Preguntas Aprobadas</h4>
                <p>{{totalPreguntas}}</p>
            </div>

            <div class="kpi-card shadow-sm">
                <h4>Preguntas Creadas por Usuarios</h4>
                <p>{{totalPreguntasUsuarios}}</p>
            </div>

        </section>

        <!-- TABLAS IMPRIMIBLES -->
        <section class="data-section mb-5">

            <h3 class="fw-bold mb-3">Datos imprimibles</h3>

            <button onclick="window.print()" class="btn btn-outline-primary mb-3">
                üñ®Ô∏è Imprimir tablas
            </button>

            <div class="table-responsive printable">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Usuario</th>
                            <th>Pa√≠s</th>
                            <th>Sexo</th>
                            <th>Edad</th>
                            <th>% Correctas</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#tablaUsuarios}}
                        <tr>
                            <td>{{nombre_usuario}}</td>
                            <td>{{pais}}</td>
                            <td>{{sexo}}</td>
                            <td>{{edad}}</td>
                            <td>{{porcentaje}}%</td>
                        </tr>
                        {{/tablaUsuarios}}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- GR√ÅFICOS -->
        <section class="charts-grid">

            <div class="chart-box shadow-sm">
                <h3>Usuarios por Pa√≠s</h3>
                <canvas id="chartPais"></canvas>
            </div>

            <div class="chart-box shadow-sm">
                <h3>Distribuci√≥n por Sexo</h3>
                <canvas id="chartSexo"></canvas>
            </div>

            <div class="chart-box shadow-sm">
                <h3>Distribuci√≥n por Edad</h3>
                <canvas id="chartEdad"></canvas>
            </div>

            <div class="chart-box shadow-sm">
                <h3>% Correctas por Usuario</h3>
                <canvas id="chartPrecision"></canvas>
            </div>

        </section>

    </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const dataPais = {{{usuariosPorPais}}};
    const dataSexo = {{{usuariosPorSexo}}};
    const dataEdad = {{{usuariosPorEdad}}};
    const dataPrecision = {{{porcentajeCorrectasPorUsuario}}};

    // Pa√≠s
    new Chart(document.getElementById("chartPais"), {
        type: 'bar',
        data: {
            labels: dataPais.map(i => i.pais),
            datasets: [{
                label: "Usuarios",
                data: dataPais.map(i => i.cantidad),
                backgroundColor: '#1fb286'
            }]
        }
    });

    // Sexo
    new Chart(document.getElementById("chartSexo"), {
        type: 'pie',
        data: {
            labels: dataSexo.map(i => i.sexo),
            datasets: [{
                data: dataSexo.map(i => i.cantidad),
                backgroundColor: ["#1fb286", "#5a4ee3", "#f6c344"]
            }]
        }
    });

    // Edad
    new Chart(document.getElementById("chartEdad"), {
        type: 'bar',
        data: {
            labels: dataEdad.map(i => i.grupo),
            datasets: [{
                label: "Usuarios",
                data: dataEdad.map(i => i.cantidad),
                backgroundColor: "#5a4ee3"
            }]
        }
    });

    // Precisi√≥n
    new Chart(document.getElementById("chartPrecision"), {
        type: 'line',
        data: {
            labels: dataPrecision.map(i => i.nombre_usuario),
            datasets: [{
                label: "% correctas",
                data: dataPrecision.map(i => i.porcentaje),
                borderColor: '#1fb286',
                borderWidth: 3,
                fill: false,
                tension: 0.3
            }]
        }
    });
</script>

<style>
    @media print {
        body * { visibility: hidden; }
        .printable, .printable * { visibility: visible; }
        .printable { position: absolute; top: 0; left: 0; width: 100%; }
    }
</style>