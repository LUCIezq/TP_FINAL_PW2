<div class="admin-container">

    <!-- SIDEBAR -->
    <aside class="admin-sidebar">
        <h2 class="sidebar-title">ADMIN</h2>

        <ul class="sidebar-menu">
            <li><a href="/admin/index" class="active">üìä Dashboard</a></li>
            <li><a href="/login/logout">üö™ Cerrar sesi√≥n</a></li>
        </ul>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="admin-main flex-fill">
        <div class="content-wrapper">

            <h1 class="dashboard-title">Panel Administrativo</h1>

            <!-- FILTRO -->
            <form method="GET" action="/admin/index" class="filter-bar">
                <label for="filtroPeriodo">Filtrar por:</label>

                <select id="filtroPeriodo" name="periodo" onchange="this.form.submit()">
                    <option value="dia" {{#isDia}}selected{{/isDia}}>Hoy</option>
                    <option value="semana" {{#isSemana}}selected{{/isSemana}}>√öltima semana</option>
                    <option value="mes" {{#isMes}}selected{{/isMes}}>√öltimo mes</option>
                    <option value="anio" {{#isAnio}}selected{{/isAnio}}>√öltimo a√±o</option>
                </select>
            </form>

            <!-- BOT√ìN IMPRIMIR -->
            <button onclick="window.print()" class="btn-print">üñ®Ô∏è Imprimir Reportes</button>

            <!-- KPI GRID -->
            <div class="kpi-grid">

                <div class="kpi-card">
                    <h4>Usuarios Registrados</h4>
                    <p>{{totalUsuarios}}</p>
                </div>

                <div class="kpi-card">
                    <h4>Partidas Jugadas</h4>
                    <p>{{totalPartidas}}</p>
                </div>

                <div class="kpi-card">
                    <h4>Preguntas Aprobadas</h4>
                    <p>{{totalPreguntas}}</p>
                </div>

                <div class="kpi-card">
                    <h4>Preguntas de Usuarios</h4>
                    <p>{{totalPreguntasUsuarios}}</p>
                </div>

            </div>

            <!-- GRAFICOS -->
            <div class="charts-grid">

                <div class="chart-box">
                    <h3>Usuarios por Pa√≠s</h3>
                    <canvas id="chartPais"></canvas>
                </div>

                <div class="chart-box">
                    <h3>Distribuci√≥n por Sexo</h3>
                    <canvas id="chartSexo"></canvas>
                </div>

                <div class="chart-box">
                    <h3>Distribuci√≥n por Edad</h3>
                    <canvas id="chartEdad"></canvas>
                </div>

                <div class="chart-box">
                    <h3>% de Respuestas Correctas por Usuario</h3>
                    <canvas id="chartPrecision"></canvas>
                </div>

            </div>

            <!-- =======================
                  TABLAS PARA IMPRIMIR
            ========================== -->
            <div class="tables-section">

                <!-- Usuarios por Pa√≠s -->
                <div class="table-box">
                    <h3>Usuarios por Pa√≠s (Tabla)</h3>
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>Pa√≠s</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#usuariosPorPaisTable}}
                            <tr>
                                <td>{{pais}}</td>
                                <td>{{cantidad}}</td>
                            </tr>
                            {{/usuariosPorPaisTable}}
                        </tbody>
                    </table>
                </div>

                <!-- Sexo -->
                <div class="table-box">
                    <h3>Distribuci√≥n por Sexo (Tabla)</h3>
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>Sexo</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#usuariosPorSexoTable}}
                            <tr>
                                <td>{{sexo}}</td>
                                <td>{{cantidad}}</td>
                            </tr>
                            {{/usuariosPorSexoTable}}
                        </tbody>
                    </table>
                </div>

                <!-- Edad -->
                <div class="table-box">
                    <h3>Distribuci√≥n por Edad (Tabla)</h3>
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>Grupo</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#usuariosPorEdadTable}}
                            <tr>
                                <td>{{grupo}}</td>
                                <td>{{cantidad}}</td>
                            </tr>
                            {{/usuariosPorEdadTable}}
                        </tbody>
                    </table>
                </div>

                <!-- Precisi√≥n -->
                <div class="table-box">
                    <h3>% de Respuestas Correctas por Usuario (Tabla)</h3>
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>Usuario</th>
                                <th>Precisi√≥n (%)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#precisionUsuariosTable}}
                            <tr>
                                <td>{{nombre_usuario}}</td>
                                <td>{{porcentaje}}</td>
                            </tr>
                            {{/precisionUsuariosTable}}
                        </tbody>
                    </table>
                </div>

            </div>

        </div>
    </main>

</div>

<!-- SCRIPTS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    window.dataPais = {{{usuariosPorPais}}};
    window.dataSexo = {{{usuariosPorSexo}}};
    window.dataEdad = {{{usuariosPorEdad}}};
    window.dataPrecision = {{{porcentajeCorrectasPorUsuario}}};
</script>

<script src="/public/js/adminDashboardCharts.js"></script>
